<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Building a Regression Model</title>

<script src="caffeine_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="caffeine_files/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="caffeine_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="caffeine_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="caffeine_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="caffeine_files/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="textbook.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Building a Regression Model</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#effect-of-caffeine-on-heart-rate">Effect of Caffeine on Heart Rate</a><ul>
<li><a href="#mcguyvers-regression-model">McGuyver’s Regression Model</a><ul>
<li><a href="#residual-standard-error">Residual Standard Error</a></li>
<li><a href="#residual-standard-error-1">Residual Standard Error</a></li>
</ul></li>
</ul></li>
<li><a href="#regression">Regression</a></li>
<li><a href="#examining-fit">Examining Fit</a><ul>
<li><a href="#residual-standard-error-2">Residual Standard Error</a></li>
<li><a href="#the-standard-deviation">The Standard Deviation</a></li>
</ul></li>
</ul>
</div>

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>( stargazer )</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>( pander )</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>( dplyr )</a></code></pre></div>
<div id="effect-of-caffeine-on-heart-rate" class="section level1">
<h1>Effect of Caffeine on Heart Rate</h1>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># https://www.theodysseyonline.com/caffeine-affect-heart-rate</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw">set.seed</span>( <span class="dv">1234</span> )</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">caffeine &lt;-<span class="st"> </span><span class="kw">runif</span>( <span class="dt">n=</span><span class="dv">100</span>, <span class="dt">min=</span><span class="dv">0</span>, <span class="dt">max=</span><span class="dv">500</span> )</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">heart.rate &lt;-<span class="st"> </span><span class="dv">68</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">9</span><span class="op">/</span><span class="dv">100</span>)<span class="op">*</span>caffeine <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>,<span class="dv">0</span>,<span class="dv">20</span>) </a>
<a class="sourceLine" id="cb2-8" data-line-number="8">heart.rate[ heart.rate <span class="op">&lt;</span><span class="st"> </span><span class="dv">40</span> ] &lt;-<span class="st"> </span><span class="kw">mean</span>(heart.rate)</a>
<a class="sourceLine" id="cb2-9" data-line-number="9"></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="kw">plot</span>( caffeine, heart.rate, <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, </a>
<a class="sourceLine" id="cb2-11" data-line-number="11">      <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="kw">gray</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="dt">cex=</span><span class="fl">1.5</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-3-1.png" width="864" /></p>
<div id="mcguyvers-regression-model" class="section level2">
<h2>McGuyver’s Regression Model</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">ave.caffeine &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">ave.heart &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="cf">for</span>( i <span class="cf">in</span> <span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">450</span>, <span class="dt">by=</span><span class="dv">50</span> ) )</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">{</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">   sub.heart &lt;-<span class="st"> </span>heart.rate[ caffeine <span class="op">&gt;</span><span class="st"> </span>i <span class="op">&amp;</span><span class="st"> </span>caffeine <span class="op">&lt;</span><span class="st"> </span>i<span class="op">+</span><span class="dv">50</span> ]</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">   sub.caffeine &lt;-<span class="st"> </span>caffeine[ caffeine <span class="op">&gt;</span><span class="st"> </span>i <span class="op">&amp;</span><span class="st"> </span>caffeine <span class="op">&lt;</span><span class="st"> </span>i<span class="op">+</span><span class="dv">50</span> ]</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"></a>
<a class="sourceLine" id="cb3-9" data-line-number="9">   ave.heart &lt;-<span class="st"> </span><span class="kw">c</span>( ave.heart, <span class="kw">mean</span>(sub.heart) )</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">   ave.caffeine &lt;-<span class="st"> </span><span class="kw">c</span>( ave.caffeine, <span class="kw">mean</span>(<span class="kw">c</span>(i,i<span class="op">+</span><span class="dv">50</span>)) )</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb3-13" data-line-number="13"></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="kw">jplot</span>( caffeine, heart.rate, <span class="dt">lab1=</span><span class="st">&quot;Caffeine&quot;</span>, <span class="dt">lab2=</span><span class="st">&quot;Heart Rate&quot;</span>, </a>
<a class="sourceLine" id="cb3-15" data-line-number="15">       <span class="dt">draw.line=</span>F )</a>
<a class="sourceLine" id="cb3-16" data-line-number="16"></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="kw">abline</span>( <span class="dt">v=</span><span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">500</span>, <span class="dt">by=</span><span class="dv">50</span> ), <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lty=</span><span class="dv">3</span> )</a>
<a class="sourceLine" id="cb3-18" data-line-number="18"></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="kw">points</span>( ave.caffeine, ave.heart, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">cex=</span><span class="dv">2</span>, <span class="dt">type=</span><span class="st">&quot;b&quot;</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-4-1.png" width="864" /></p>
<p>Or alternatively, we could look at box and whisker plots calculated for each group.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">caffeine.group &lt;-<span class="st"> </span><span class="kw">cut</span>( caffeine, <span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">500</span>, <span class="dt">by=</span><span class="dv">50</span> ) )</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw">boxplot</span>( heart.rate <span class="op">~</span><span class="st"> </span>caffeine.group, </a>
<a class="sourceLine" id="cb4-4" data-line-number="4">         <span class="dt">las=</span><span class="dv">2</span>, <span class="dt">frame.plot=</span>F, <span class="dt">outline=</span>F, <span class="dt">main=</span><span class="st">&quot;Heart Rate by Caffeine Intake&quot;</span>,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">         <span class="dt">col=</span><span class="st">&quot;steelblue&quot;</span>, <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-5-1.png" width="864" /></p>
<p>The blue line is the average heart rate for the whole sample. This red dots then are what is known asd a conditional mean.</p>
<p>Is this a good model of heart rate, though?</p>
<p>If you tell me the caffeine intake of the subject, I can give you a pretty good guess of their heart rate.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">jplot</span>( caffeine, heart.rate, <span class="dt">lab1=</span><span class="st">&quot;Caffeine&quot;</span>, <span class="dt">lab2=</span><span class="st">&quot;Heart Rate&quot;</span>, </a>
<a class="sourceLine" id="cb5-2" data-line-number="2">       <span class="dt">draw.line=</span>F )</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw">abline</span>( <span class="dt">h=</span><span class="kw">mean</span>(heart.rate), <span class="dt">col=</span><span class="st">&quot;steelblue&quot;</span>, <span class="dt">lwd=</span><span class="dv">3</span> )</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="kw">abline</span>( <span class="dt">v=</span><span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">500</span>, <span class="dt">by=</span><span class="dv">50</span> ), <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lty=</span><span class="dv">3</span> )</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="kw">points</span>( ave.caffeine, ave.heart, <span class="dt">pch=</span><span class="dv">19</span>, <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">cex=</span><span class="dv">2</span>, <span class="dt">type=</span><span class="st">&quot;b&quot;</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-6-1.png" width="864" /></p>
<p>compare residuals of base model to residuals of conditional mean.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">jplot</span>( caffeine, heart.rate, <span class="dt">lab1=</span><span class="st">&quot;Caffeine&quot;</span>, <span class="dt">lab2=</span><span class="st">&quot;Heart Rate&quot;</span>, </a>
<a class="sourceLine" id="cb6-2" data-line-number="2">       <span class="dt">draw.line=</span>F )</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co"># abline( h=mean(heart.rate), col=&quot;steelblue&quot;, lwd=3 )</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">bins &lt;-<span class="st"> </span><span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">500</span>, <span class="dt">by=</span><span class="dv">50</span> )</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="kw">abline</span>( <span class="dt">v=</span><span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">500</span>, <span class="dt">by=</span><span class="dv">50</span> ), <span class="dt">col=</span><span class="st">&quot;darkgray&quot;</span>, <span class="dt">lty=</span><span class="dv">3</span> )</a>
<a class="sourceLine" id="cb6-9" data-line-number="9"></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co"># points( ave.caffeine, ave.heart, pch=19, col=&quot;darkgray&quot;, cex=2, type=&quot;b&quot; )</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="kw">segments</span>( <span class="dt">x0=</span>bins[<span class="op">-</span><span class="kw">length</span>(bins)], <span class="dt">x1=</span>bins[<span class="op">-</span><span class="dv">1</span>], </a>
<a class="sourceLine" id="cb6-13" data-line-number="13">          <span class="dt">y0=</span>ave.heart, <span class="dt">col=</span><span class="st">&quot;darkgray&quot;</span>, <span class="dt">lwd=</span><span class="dv">3</span> )</a>
<a class="sourceLine" id="cb6-14" data-line-number="14"></a>
<a class="sourceLine" id="cb6-15" data-line-number="15">caffeine.group &lt;-<span class="st"> </span><span class="kw">cut</span>( caffeine, <span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">500</span>, <span class="dt">by=</span><span class="dv">50</span> ) )</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">d2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>( caffeine, heart.rate, caffeine.group )</a>
<a class="sourceLine" id="cb6-17" data-line-number="17"></a>
<a class="sourceLine" id="cb6-18" data-line-number="18">pred.y &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb6-19" data-line-number="19"><span class="st">  </span>d2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-20" data-line-number="20"><span class="st">  </span><span class="kw">group_by</span>( caffeine.group ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="st">  </span><span class="kw">mutate</span>( <span class="dt">mean.hr =</span> <span class="kw">mean</span>(heart.rate), <span class="dt">residual=</span>heart.rate<span class="op">-</span>mean.hr ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb6-23" data-line-number="23"></a>
<a class="sourceLine" id="cb6-24" data-line-number="24"><span class="kw">segments</span>( <span class="dt">x0=</span>caffeine, <span class="dt">y0=</span>pred.y<span class="op">$</span>mean.hr, <span class="dt">y1=</span>pred.y<span class="op">$</span>heart.rate, <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-7-1.png" width="864" /></p>
<div id="residual-standard-error" class="section level3">
<h3>Residual Standard Error</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">sd</span>( pred.y<span class="op">$</span>heart.rate <span class="op">-</span><span class="st"> </span>pred.y<span class="op">$</span>mean.hr )</a></code></pre></div>
<pre><code>## [1] 17.68936</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">jplot</span>( caffeine, heart.rate, <span class="dt">lab1=</span><span class="st">&quot;Caffeine&quot;</span>, <span class="dt">lab2=</span><span class="st">&quot;Heart Rate&quot;</span>, </a>
<a class="sourceLine" id="cb9-2" data-line-number="2">       <span class="dt">draw.line=</span>F )</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="kw">abline</span>( <span class="dt">h=</span><span class="kw">mean</span>(heart.rate), <span class="dt">col=</span><span class="st">&quot;darkgray&quot;</span>, <span class="dt">lwd=</span><span class="dv">3</span> )</a>
<a class="sourceLine" id="cb9-5" data-line-number="5"></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="kw">segments</span>( <span class="dt">x0=</span>caffeine, <span class="dt">y0=</span><span class="kw">mean</span>(heart.rate), <span class="dt">y1=</span>heart.rate, <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-9-1.png" width="864" /></p>
</div>
<div id="residual-standard-error-1" class="section level3">
<h3>Residual Standard Error</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">sd</span>( heart.rate <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(heart.rate) )</a></code></pre></div>
<pre><code>## [1] 22.01389</code></pre>
</div>
</div>
</div>
<div id="regression" class="section level1">
<h1>Regression</h1>
<p>Why don’t we just use these groups?</p>
<p>Part of the reason is that when we try to get more granular estimates of the treatment we begin to get noisy data with lots of holes in it as we try to slice the data thinner and thinner.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">caffeine.group &lt;-<span class="st"> </span><span class="kw">cut</span>( caffeine, <span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">500</span>, <span class="dt">by=</span><span class="dv">10</span> ) )</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="kw">boxplot</span>( heart.rate <span class="op">~</span><span class="st"> </span>caffeine.group, </a>
<a class="sourceLine" id="cb12-4" data-line-number="4">         <span class="dt">las=</span><span class="dv">2</span>, <span class="dt">frame.plot=</span>F, <span class="dt">outline=</span>F, <span class="dt">main=</span><span class="st">&quot;Heart Rate by Caffeine Intake&quot;</span>,</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">         <span class="dt">col=</span><span class="st">&quot;steelblue&quot;</span>, <span class="dt">xaxt=</span><span class="st">&quot;n&quot;</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-11-1.png" width="864" /></p>
<p>The more important reason we will discuss in a couple of weeks. That is the ability to add control variables. The regression model gives us a very clear estimate of the “average effect” of one mg of caffeine on heart rate.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">mod &lt;-<span class="st"> </span><span class="kw">lm</span>( heart.rate <span class="op">~</span><span class="st"> </span>caffeine )</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="kw">stargazer</span>( mod, <span class="dt">header=</span>F, <span class="dt">type=</span><span class="st">&quot;html&quot;</span> )</a></code></pre></div>
<table style="text-align:center">
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
heart.rate
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
caffeine
</td>
<td>
0.084<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.014)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
71.470<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(3.503)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
100
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.282
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.274
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
18.755 (df = 98)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
38.401<sup>***</sup> (df = 1; 98)
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td style="text-align:right">
<sup><em></sup>p&lt;0.1; <sup><strong></sup>p&lt;0.05; <sup></strong></em></sup>p&lt;0.01
</td>
</tr>
</table>
<p>As you can see, the regression model is another form of the conditional mean. If you tell me the caffeine intake of the subject, I can give you a good guess of their heart rate.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">jplot</span>( caffeine, heart.rate, <span class="dt">lab1=</span><span class="st">&quot;Caffeine&quot;</span>, <span class="dt">lab2=</span><span class="st">&quot;Heart Rate&quot;</span>, </a>
<a class="sourceLine" id="cb14-2" data-line-number="2">       <span class="dt">draw.line=</span>F )</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="kw">abline</span>( <span class="dt">v=</span><span class="kw">seq</span>( <span class="dt">from=</span><span class="dv">0</span>, <span class="dt">to=</span><span class="dv">500</span>, <span class="dt">by=</span><span class="dv">50</span> ), <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lty=</span><span class="dv">3</span> )</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="kw">points</span>( ave.caffeine, ave.heart, <span class="dt">pch=</span><span class="dv">1</span>, <span class="dt">col=</span><span class="st">&quot;black&quot;</span>, <span class="dt">cex=</span><span class="dv">2</span>, <span class="dt">type=</span><span class="st">&quot;b&quot;</span> )</a>
<a class="sourceLine" id="cb14-7" data-line-number="7"></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="kw">abline</span>( <span class="kw">lm</span>( heart.rate <span class="op">~</span><span class="st"> </span>caffeine ), <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-13-1.png" width="864" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">b0 &lt;-<span class="st"> </span><span class="kw">coefficients</span>( mod )[<span class="st">&quot;(Intercept)&quot;</span>]</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">b1 &lt;-<span class="st"> </span><span class="kw">coefficients</span>( mod )[<span class="st">&quot;caffeine&quot;</span>]</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"></a>
<a class="sourceLine" id="cb15-4" data-line-number="4">predicted.heart &lt;-<span class="st"> </span>b0 <span class="op">+</span><span class="st"> </span>b1<span class="op">*</span>ave.caffeine</a>
<a class="sourceLine" id="cb15-5" data-line-number="5"></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">residual &lt;-<span class="st"> </span>ave.heart <span class="op">-</span><span class="st"> </span>predicted.heart</a>
<a class="sourceLine" id="cb15-7" data-line-number="7"></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="kw">data.frame</span>( ave.caffeine, ave.heart, predicted.heart, residual ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="st">  </span><span class="kw">stargazer</span>( <span class="dt">summary=</span>F, <span class="dt">type=</span><span class="st">&quot;html&quot;</span> )</a></code></pre></div>
<table style="text-align:center">
<tr>
<td colspan="5" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
ave.caffeine
</td>
<td>
ave.heart
</td>
<td>
predicted.heart
</td>
<td>
residual
</td>
</tr>
<tr>
<td colspan="5" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
1
</td>
<td>
25
</td>
<td>
80.703
</td>
<td>
73.565
</td>
<td>
7.138
</td>
</tr>
<tr>
<td style="text-align:left">
2
</td>
<td>
75
</td>
<td>
75.926
</td>
<td>
77.756
</td>
<td>
-1.830
</td>
</tr>
<tr>
<td style="text-align:left">
3
</td>
<td>
125
</td>
<td>
83.979
</td>
<td>
81.947
</td>
<td>
2.032
</td>
</tr>
<tr>
<td style="text-align:left">
4
</td>
<td>
175
</td>
<td>
75.655
</td>
<td>
86.138
</td>
<td>
-10.484
</td>
</tr>
<tr>
<td style="text-align:left">
5
</td>
<td>
225
</td>
<td>
89.738
</td>
<td>
90.329
</td>
<td>
-0.592
</td>
</tr>
<tr>
<td style="text-align:left">
6
</td>
<td>
275
</td>
<td>
93.221
</td>
<td>
94.520
</td>
<td>
-1.299
</td>
</tr>
<tr>
<td style="text-align:left">
7
</td>
<td>
325
</td>
<td>
98.045
</td>
<td>
98.711
</td>
<td>
-0.666
</td>
</tr>
<tr>
<td style="text-align:left">
8
</td>
<td>
375
</td>
<td>
115.826
</td>
<td>
102.902
</td>
<td>
12.924
</td>
</tr>
<tr>
<td style="text-align:left">
9
</td>
<td>
425
</td>
<td>
103.480
</td>
<td>
107.093
</td>
<td>
-3.613
</td>
</tr>
<tr>
<td style="text-align:left">
10
</td>
<td>
475
</td>
<td>
113.210
</td>
<td>
111.284
</td>
<td>
1.925
</td>
</tr>
<tr>
<td colspan="5" style="border-bottom: 1px solid black">
</td>
</tr>
</table>
</div>
<div id="examining-fit" class="section level1">
<h1>Examining Fit</h1>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">jplot</span>( caffeine, heart.rate, <span class="dt">lab1=</span><span class="st">&quot;Caffeine&quot;</span>, <span class="dt">lab2=</span><span class="st">&quot;Heart Rate&quot;</span>, </a>
<a class="sourceLine" id="cb16-2" data-line-number="2">       <span class="dt">draw.line=</span>F )</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="kw">abline</span>( <span class="kw">lm</span>( heart.rate <span class="op">~</span><span class="st"> </span>caffeine ), <span class="dt">col=</span><span class="st">&quot;darkgray&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span> )</a>
<a class="sourceLine" id="cb16-5" data-line-number="5"></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="kw">segments</span>( <span class="dt">x0=</span>caffeine, <span class="dt">y0=</span><span class="kw">predict</span>(mod), <span class="dt">y1=</span>heart.rate, <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-15-1.png" width="864" /></p>
<div id="residual-standard-error-2" class="section level2">
<h2>Residual Standard Error</h2>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">set.seed</span>( <span class="dv">2345</span> )</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"></a>
<a class="sourceLine" id="cb17-3" data-line-number="3">heart.rate.control &lt;-<span class="st"> </span><span class="dv">68</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">9</span><span class="op">/</span><span class="dv">100</span>)<span class="op">*</span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>,<span class="dv">0</span>,<span class="dv">20</span>)  <span class="co"># no caffeine</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4">heart.rate.control[ heart.rate.control <span class="op">&lt;</span><span class="st"> </span><span class="dv">40</span> ] &lt;-<span class="st"> </span><span class="kw">mean</span>(heart.rate.control)</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">y.hat &lt;-<span class="st"> </span><span class="kw">mean</span>(heart.rate.control)</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">d &lt;-<span class="st"> </span><span class="kw">density</span>( heart.rate.control ) <span class="co"># returns the density data </span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="kw">plot</span>( d , <span class="dt">bty=</span><span class="st">&quot;n&quot;</span>, <span class="dt">main=</span><span class="st">&quot;Distribution of Resting Heart Rates in Population&quot;</span>, </a>
<a class="sourceLine" id="cb18-3" data-line-number="3">      <span class="dt">xlab=</span><span class="st">&quot;&quot;</span>, <span class="dt">yaxt=</span><span class="st">&quot;n&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;&quot;</span> )</a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="kw">polygon</span>( d, <span class="dt">col=</span><span class="kw">gray</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>), <span class="dt">border=</span><span class="st">&quot;gray&quot;</span> ) </a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="kw">abline</span>( <span class="dt">v=</span><span class="kw">mean</span>(heart.rate.control), <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span> )</a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="kw">abline</span>( <span class="dt">v=</span><span class="kw">mean</span>(heart.rate.control)<span class="op">+</span><span class="kw">sd</span>(heart.rate.control), <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lty=</span><span class="dv">2</span> )</a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="kw">abline</span>( <span class="dt">v=</span><span class="kw">mean</span>(heart.rate.control)<span class="op">-</span><span class="kw">sd</span>(heart.rate.control), <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lty=</span><span class="dv">2</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-17-1.png" width="864" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">jplot</span>( caffeine, heart.rate.control, </a>
<a class="sourceLine" id="cb19-2" data-line-number="2">       <span class="dt">lab1=</span><span class="st">&quot;Caffeine&quot;</span>, <span class="dt">lab2=</span><span class="st">&quot;Heart Rate&quot;</span>, </a>
<a class="sourceLine" id="cb19-3" data-line-number="3">       <span class="dt">draw.line=</span>F )</a>
<a class="sourceLine" id="cb19-4" data-line-number="4"></a>
<a class="sourceLine" id="cb19-5" data-line-number="5">y.hat &lt;-<span class="st"> </span><span class="kw">mean</span>( heart.rate.control )</a>
<a class="sourceLine" id="cb19-6" data-line-number="6">sd.y &lt;-<span class="st">  </span><span class="kw">sd</span>( heart.rate.control )</a>
<a class="sourceLine" id="cb19-7" data-line-number="7"></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="kw">abline</span>( <span class="dt">h=</span>y.hat, <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span> )</a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="kw">abline</span>( <span class="dt">h=</span><span class="kw">c</span>( y.hat<span class="op">+</span>sd.y, y.hat<span class="op">-</span>sd.y ), <span class="dt">lty=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-18-1.png" width="864" /></p>
</div>
<div id="the-standard-deviation" class="section level2">
<h2>The Standard Deviation</h2>
<p>Standard deviation is the “average” distance from each data point to the mean.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">jplot</span>( caffeine, heart.rate.control, </a>
<a class="sourceLine" id="cb20-2" data-line-number="2">       <span class="dt">lab1=</span><span class="st">&quot;Caffeine&quot;</span>, <span class="dt">lab2=</span><span class="st">&quot;Heart Rate&quot;</span>, </a>
<a class="sourceLine" id="cb20-3" data-line-number="3">       <span class="dt">draw.line=</span>F )</a>
<a class="sourceLine" id="cb20-4" data-line-number="4"></a>
<a class="sourceLine" id="cb20-5" data-line-number="5">y.hat &lt;-<span class="st"> </span><span class="kw">mean</span>(heart.rate.control)</a>
<a class="sourceLine" id="cb20-6" data-line-number="6"><span class="kw">abline</span>( <span class="dt">h=</span>y.hat, <span class="dt">col=</span><span class="st">&quot;darkgray&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span> )</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"><span class="kw">segments</span>( <span class="dt">x0=</span>caffeine, <span class="dt">y0=</span>y.hat, <span class="dt">y1=</span>heart.rate.control, <span class="dt">col=</span><span class="st">&quot;firebrick&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span> )</a></code></pre></div>
<p><img src="caffeine_files/figure-html/unnamed-chunk-19-1.png" width="864" /></p>
<p>We use squared deviations for the variance instead of absolute values, but the intuition is the same and the measures will often be close:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">sd</span>( heart.rate.control )</a></code></pre></div>
<pre><code>## [1] 17.52184</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">mean</span>( <span class="kw">abs</span>( heart.rate.control <span class="op">-</span><span class="st"> </span>y.hat ) ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 13.81</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># why is this zero?</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="kw">mean</span>( heart.rate.control <span class="op">-</span><span class="st"> </span>y.hat ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">e &lt;-<span class="st">  </span>heart.rate <span class="op">-</span><span class="st"> </span><span class="kw">predict</span>(mod)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">mean</span>( <span class="kw">abs</span>(e) )</a></code></pre></div>
<pre><code>## [1] 14.77745</code></pre>
<p>On average our predicted heart rate was 14.7774456 from the true heart rate.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
