<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Building a Regression Model</title>

<script src="caffeine_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="caffeine_files/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="caffeine_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="caffeine_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="caffeine_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="caffeine_files/navigation-1.1/tabsets.js"></script>




<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="textbook.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Building a Regression Model</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#effect-of-caffeine-on-heart-rate"><span class="toc-section-number">1</span> Effect of Caffeine on Heart Rate</a><ul>
<li><a href="#diy-regression"><span class="toc-section-number">1.1</span> DIY Regression</a></li>
<li><a href="#the-conditional-mean"><span class="toc-section-number">1.2</span> The Conditional Mean</a></li>
</ul></li>
<li><a href="#formula-for-the-regression"><span class="toc-section-number">2</span> Formula for the Regression</a><ul>
<li><a href="#the-variance-of-y"><span class="toc-section-number">2.1</span> The Variance of Y</a></li>
<li><a href="#the-standard-deviation"><span class="toc-section-number">2.2</span> The Standard Deviation</a></li>
</ul></li>
<li><a href="#partitioning-the-variance"><span class="toc-section-number">3</span> Partitioning The Variance</a><ul>
<li><a href="#residual-standard-error"><span class="toc-section-number">3.0.1</span> Residual Standard Error</a></li>
<li><a href="#residual-standard-error-1"><span class="toc-section-number">3.0.2</span> Residual Standard Error</a></li>
</ul></li>
<li><a href="#regression"><span class="toc-section-number">4</span> Regression</a></li>
<li><a href="#examining-fit"><span class="toc-section-number">5</span> Examining Fit</a></li>
</ul>
</div>

<div id="effect-of-caffeine-on-heart-rate" class="section level1">
<h1><span class="header-section-number">1</span> Effect of Caffeine on Heart Rate</h1>
<p>We are interested in understanding the effect that caffeine has on heart rate. We have designed a study with 100 participants and randomly assigned dosages of caffeine between 0 and 500 mg. We are now trying to determine whether caffeine raises heart rate significantly.</p>
<p>The relationship looks as follows:</p>
<p><img src="caffeine_files/figure-html/unnamed-chunk-3-1.png" width="864" /></p>
<div id="diy-regression" class="section level2">
<h2><span class="header-section-number">1.1</span> DIY Regression</h2>
<p>It looks as though heart rate does increase with the level of caffeine administered. But by how much?</p>
<p>One simplistic way we can analyze the data is by splitting it into several ranges of treatment and calculating the average heart rate for each group:</p>
<p><img src="caffeine_files/figure-html/unnamed-chunk-4-1.png" width="864" /></p>
<p>Or alternatively, we could look at box and whisker plot of each group.</p>
<p><img src="caffeine_files/figure-html/unnamed-chunk-5-1.png" width="864" /></p>
</div>
<div id="the-conditional-mean" class="section level2">
<h2><span class="header-section-number">1.2</span> The Conditional Mean</h2>
<p>Either way, what we are doing here is basically a mathematically imprecise do-it-yourself regression model. Although this is a fairly blunt way to analyze the data, it is actually not too far off from our more mathematically elegant regression line:</p>
<p><img src="caffeine_files/figure-html/unnamed-chunk-7-1.png" width="864" /></p>
<p>This does demonstrate an important point, however. The regression model is a <strong>conditional mean</strong>: it gives you the average heart rate of a subject conditional on how much caffeine they consumed.</p>
<p>In other words, if you tell me the caffeine intake of the subject, I can give you a good guess of their heart rate.</p>
<p><img src="caffeine_files/figure-html/unnamed-chunk-8-1.png" width="864" /></p>
<center>
The models give us a guess for what the heart rate will be for subjects within a specific treatment group (level of caffeine). Both models return similar results.
</center>
<p><br> <br></p>
<div class="tip">
<p><br></p>
<p>The regression line represents the average value of Y conditional on each level of X.</p>
<p>In other words, a regression is just a fancy average.</p>
<p><br></p>
</div>
<p><br></p>
<table style="text-align:center">
<tr>
<td colspan="5" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
ave.caffeine
</td>
<td>
ave.heart
</td>
<td>
predicted.heart
</td>
<td>
difference
</td>
</tr>
<tr>
<td colspan="5" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
1
</td>
<td>
25
</td>
<td>
80.703
</td>
<td>
73.565
</td>
<td>
7.138
</td>
</tr>
<tr>
<td style="text-align:left">
2
</td>
<td>
75
</td>
<td>
75.926
</td>
<td>
77.756
</td>
<td>
-1.830
</td>
</tr>
<tr>
<td style="text-align:left">
3
</td>
<td>
125
</td>
<td>
83.979
</td>
<td>
81.947
</td>
<td>
2.032
</td>
</tr>
<tr>
<td style="text-align:left">
4
</td>
<td>
175
</td>
<td>
75.655
</td>
<td>
86.138
</td>
<td>
-10.484
</td>
</tr>
<tr>
<td style="text-align:left">
5
</td>
<td>
225
</td>
<td>
89.738
</td>
<td>
90.329
</td>
<td>
-0.592
</td>
</tr>
<tr>
<td style="text-align:left">
6
</td>
<td>
275
</td>
<td>
93.221
</td>
<td>
94.520
</td>
<td>
-1.299
</td>
</tr>
<tr>
<td style="text-align:left">
7
</td>
<td>
325
</td>
<td>
98.045
</td>
<td>
98.711
</td>
<td>
-0.666
</td>
</tr>
<tr>
<td style="text-align:left">
8
</td>
<td>
375
</td>
<td>
115.826
</td>
<td>
102.902
</td>
<td>
12.924
</td>
</tr>
<tr>
<td style="text-align:left">
9
</td>
<td>
425
</td>
<td>
103.480
</td>
<td>
107.093
</td>
<td>
-3.613
</td>
</tr>
<tr>
<td style="text-align:left">
10
</td>
<td>
475
</td>
<td>
113.210
</td>
<td>
111.284
</td>
<td>
1.925
</td>
</tr>
<tr>
<td colspan="5" style="border-bottom: 1px solid black">
</td>
</tr>
</table>
</div>
</div>
<div id="formula-for-the-regression" class="section level1">
<h1><span class="header-section-number">2</span> Formula for the Regression</h1>
<p>Our regression <strong>line</strong> can be written as:</p>
<blockquote>
<p><span class="math inline">\(Y = b_0 + b_1 X + e\)</span></p>
</blockquote>
<p>The regression <strong>model</strong> needs to include the residual <em>e</em>.</p>
<blockquote>
<p><span class="math inline">\(Y = b_0 + b_1 X + e\)</span></p>
</blockquote>
<p>The slope of a regression line can be calculated as a ratio of the covariance of X and Y to the variance of X.</p>
<blockquote>
<p><span class="math inline">\(b_1 = cov(x,y) / var(x)\)</span></p>
</blockquote>
<p>If you give it some thought, this is a pretty intuitive formula. When X varies by one unit, how much do we expect Y to covary?</p>
<p>Finding the intercept of the regression is a little tricky because after solving for <span class="math inline">\(b_1\)</span> we have three unknown variables (X, Y, and <span class="math inline">\(b_0\)</span> ) and only one equation. We need to draw upon the fact that the OLS regression line always passes through the mean of X and the mean of Y, giving us two known values.</p>
<blockquote>
<p><span class="math inline">\(\bar{y} = b_0 + b_1 \bar{x}\)</span></p>
</blockquote>
<p><span class="math inline">\(b_1\)</span> = cov(caffeine,heart.rate) / var(caffeine) = <strong>0.08</strong></p>
<p>90 = <span class="math inline">\(b_0\)</span> + 0.08 <span class="math inline">\(\cdot\)</span> 219 <span class="math inline">\(b_0\)</span> = <strong>71.47</strong></p>
<p>The regression model gives us a very clear estimate of the “average effect” of one mg of caffeine on heart rate.</p>
<table style="text-align:center">
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
<em>Dependent variable:</em>
</td>
</tr>
<tr>
<td>
</td>
<td colspan="1" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
heart.rate
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
caffeine
</td>
<td>
0.084<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(0.014)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td style="text-align:left">
Constant
</td>
<td>
71.470<sup>***</sup>
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
(3.503)
</td>
</tr>
<tr>
<td style="text-align:left">
</td>
<td>
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
Observations
</td>
<td>
100
</td>
</tr>
<tr>
<td style="text-align:left">
R<sup>2</sup>
</td>
<td>
0.282
</td>
</tr>
<tr>
<td style="text-align:left">
Adjusted R<sup>2</sup>
</td>
<td>
0.274
</td>
</tr>
<tr>
<td style="text-align:left">
Residual Std. Error
</td>
<td>
18.755 (df = 98)
</td>
</tr>
<tr>
<td style="text-align:left">
F Statistic
</td>
<td>
38.401<sup>***</sup> (df = 1; 98)
</td>
</tr>
<tr>
<td colspan="2" style="border-bottom: 1px solid black">
</td>
</tr>
<tr>
<td style="text-align:left">
<em>Note:</em>
</td>
<td style="text-align:right">
<sup><em></sup>p&lt;0.1; <sup><strong></sup>p&lt;0.05; <sup></strong></em></sup>p&lt;0.01
</td>
</tr>
</table>
<div id="the-variance-of-y" class="section level2">
<h2><span class="header-section-number">2.1</span> The Variance of Y</h2>
<p>Let’s consider the study population before they received the treatment in order to examine the distribution of heart rates through the population - the variance of heart rate.</p>
<p>The solid red line represents the population mean, and the dotted red lines fall one standard deviation from the mean in either direction.</p>
<p>What does a <strong>standard deviation</strong> actually mean, though?</p>
<p><img src="caffeine_files/figure-html/unnamed-chunk-12-1.png" width="864" /></p>
<p>If we return to the scatterplot view of the data, we can present the same information using datapoints instead of a density plot. The solid red line represents the population mean, and the dotted red lines fall one standard deviation from the mean in either direction.</p>
<p><img src="caffeine_files/figure-html/unnamed-chunk-13-1.png" width="864" /></p>
</div>
<div id="the-standard-deviation" class="section level2">
<h2><span class="header-section-number">2.2</span> The Standard Deviation</h2>
<p>In very simple (and not mathematically correct) terms, the standard deviation is the <strong>“average” distance from each data point to the mean</strong>.</p>
<p><img src="caffeine_files/figure-html/unnamed-chunk-14-1.png" width="864" /></p>
<p>We are using the term “average” here because we actually use squared deviations from the mean to calculate variance, then take the square root to get the measures back to the original units. The standard deviation would be a true average if we had used the absolute value of distances from the mean, but the intuition is the same and the measures will often be close:</p>
<p><strong>Standard Deviation:</strong></p>
<pre><code>## [1] 17.52184</code></pre>
<p><strong>True Average Dist Between Data and Mean:</strong></p>
<pre><code>## [1] 13.81</code></pre>
<p><img src="caffeine_files/figure-html/unnamed-chunk-17-1.png" width="864" /></p>
<pre><code>##  [1] 23.2440659 18.0340471 14.6260891 22.2501259 21.1077332 10.4945604
##  [7] 10.1823190  6.4918156 29.5889871  0.2889127</code></pre>
</div>
</div>
<div id="partitioning-the-variance" class="section level1">
<h1><span class="header-section-number">3</span> Partitioning The Variance</h1>
<p>The blue line is the average heart rate for the whole sample. This red dots then are what is known asd a conditional mean.</p>
<p>Is this a good model of heart rate, though?</p>
<p>If you tell me the caffeine intake of the subject, I can give you a pretty good guess of their heart rate.</p>
<p><img src="caffeine_files/figure-html/unnamed-chunk-19-1.png" width="864" /></p>
<p>compare residuals of base model to residuals of conditional mean.</p>
<p><img src="caffeine_files/figure-html/unnamed-chunk-20-1.png" width="864" /></p>
<div id="residual-standard-error" class="section level3">
<h3><span class="header-section-number">3.0.1</span> Residual Standard Error</h3>
<pre><code>## [1] 21.38787</code></pre>
<p><img src="caffeine_files/figure-html/unnamed-chunk-22-1.png" width="864" /></p>
</div>
<div id="residual-standard-error-1" class="section level3">
<h3><span class="header-section-number">3.0.2</span> Residual Standard Error</h3>
<pre><code>## [1] 22.01389</code></pre>
</div>
</div>
<div id="regression" class="section level1">
<h1><span class="header-section-number">4</span> Regression</h1>
<p>Why don’t we just use these groups?</p>
<p>Part of the reason is that when we try to get more granular estimates of the treatment we begin to get noisy data with lots of holes in it as we try to slice the data thinner and thinner.</p>
<p><img src="caffeine_files/figure-html/unnamed-chunk-24-1.png" width="864" /></p>
<p>The more important reason we will discuss in a couple of weeks. That is the ability to add control variables.</p>
</div>
<div id="examining-fit" class="section level1">
<h1><span class="header-section-number">5</span> Examining Fit</h1>
<p><img src="caffeine_files/figure-html/unnamed-chunk-25-1.png" width="864" /></p>
<pre><code>## [1] 14.77745</code></pre>
<p>On average our predicted heart rate was 14.7774456 from the true heart rate.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
